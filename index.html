<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 2027 Widgets Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }

        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        h2 {
            color: #2c3e50;
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .widget-container {
            display: block;
            text-align: center;
            margin: 20px auto;
            padding: 30px;
            width: 100%;
            min-height: 600px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
            box-sizing: border-box;
        }

        .widget-container h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 20px;
        }

        .widget-container h2 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 10px;
            font-size: 24px;
            text-align: left;
        }

        .widget-container p {
            text-align: left;
        }

        .widget-canvas {
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f8f9fa;
            cursor: crosshair;
            max-width: 100%;
            display: block;
            margin: 0 auto;
        }

        .comparisons-widget-canvas {
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f8f9fa;
            max-width: 100%;
            display: block;
            margin: 0 auto;
        }



        .highlight {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .instructions {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 12px;
            margin: 20px 0;
            border-radius: 4px;
        }



        /* Remove spinner arrows from number input */
        #total-mass::-webkit-outer-spin-button,
        #total-mass::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        #total-mass[type=number] {
            appearance: textfield;
        }

        /* Enhanced number input styling */
        .number-input-container {
            display: inline-flex;
            align-items: center;
            position: relative;
        }

        .number-input {
            padding: 4px 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 30px;
            text-align: center;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .number-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }

        .number-input.invalid {
            border-color: #dc3545;
            background-color: #fff5f5;
        }

        .input-feedback {
            position: absolute;
            top: 100%;
            left: 40%;
            transform: translateX(-50%);
            font-size: 11px;
            color: #6c757d;
            white-space: nowrap;
            margin-top: 0px;
            text-align: center;
            width: 100%;
        }

        .input-feedback.error {
            color: #dc3545;
        }

        .input-feedback.success {
            color: #28a745;
        }

        /* Visibility toggle styles */
        .visibility-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .visibility-toggle input[type="checkbox"] {
            margin: 0;
            cursor: pointer;
            accent-color: #495057;
        }

        .visibility-toggle input[type="checkbox"]:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .visibility-toggle .color-box {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            border: 1px solid #ccc;
        }

        .visibility-toggle .label {
            font-size: 12px;
            font-weight: 500;
            color: #495057;
        }

        /* Button hover effects */
        #add-distribution:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>AI 2027 Widgets Demo</h1>

    <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod
        tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim
        veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
        commodo consequat.
    </p>

    <p>
        Duis aute irure dolor in reprehenderit in voluptate velit esse cillum
        dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
        proident, sunt in culpa qui officia deserunt mollit anim id est
        laborum.
    </p>

    <p>
        Sed ut perspiciatis unde omnis iste natus error sit voluptatem
        accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae
        ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt
        explicabo.
    </p>

    <p>
        Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut
        fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem
        sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor
        sit amet, consectetur, adipisci velit, sed quia non numquam eius modi
        tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem.
    </p>

    <div class="widget-container">
        <h2>AGI Timelines</h2>
        <div class="instructions">
            <strong>Instructions:</strong> Sketch a probability distribution by
            selecting it from the dropdown and drawing with the mouse. Toggle
            the visibility of other distributions in the background with their
            checkboxes. The vertical dotted line indicates the median quarter
            of the current distribution. The furthest-right bin represents "AGI
            is first developed after the year 2039 or never," so you should
            probably place a larger spike at that rightmost edge.
        </div>

        <!-- Distribution Controls -->
        <div style="margin-bottom: 20px; text-align: center;">
            <div style="display: flex; justify-content: center; align-items:
            center; gap: 15px; flex-wrap: wrap;">
                <!-- Color Selection -->
                <div style="display: flex; align-items: center; gap: 8px;">
                    <label for="distribution-color" style="font-weight:
                    bold;">Current:</label>
                    <select id="distribution-color" style="padding: 4px 8px;
                    border: 1px solid #ccc; border-radius: 4px; font-size:
                    14px;">
                        <option value="blue">Blue</option>
                        <option value="green">Green</option>
                        <option value="red">Red</option>
                        <option value="purple">Purple</option>
                        <option value="orange">Orange</option>
                        <option value="yellow">Yellow</option>
                    </select>
                </div>
                
                <!-- Visibility Toggles -->
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-weight: bold;">Show:</span>
                    <div id="visibility-toggles" style="display: flex; gap:
                    16px; flex-wrap: wrap;">
                        <!-- Checkboxes will be added here dynamically -->
                    </div>
                </div>

            </div>
        </div>
        

        

        <div id="distribution-widget"></div>
    </div>

    <div class="widget-container">
        <h2>Distribution Comparisons</h2>
        <div class="instructions">
            <strong>Instructions:</strong> Toggle the visibility of each
            distribution with its checkbox.
        </div>
        <div id="comparisons-widget"></div>
        
        <div style="margin-top: 30px;">
            <div class="instructions">
                <strong>Instructions:</strong> Select a ground truth
                distribution in the dropdown. The KL divergence of each
                distribution, with respect to the ground truth distribution, is
                shown in the table. KL divergence is a measure of how much two
                distributions on the same event space differ. Lower values
                indicate closer agreement, and 0 indicates identical
                distributions. The table is ordered from most to least
                matching.
            </div>
            <div id="bayesian-comparisons-widget"></div>
        </div>
    </div>

    <p>
        Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis
        suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis
        autem vel eum iure reprehenderit qui in ea voluptate velit esse quam
        nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo
        voluptas nulla pariatur?
    </p>

    <p>
        Vivamus congue mauris neque, sollicitudin porttitor ipsum tempus
        eleifend. Interdum et malesuada fames ac ante ipsum primis in faucibus.
        Mauris molestie sodales commodo. Nunc ultrices mauris magna, non
        condimentum tellus varius a. Praesent hendrerit, massa ac iaculis
        scelerisque, risus est maximus risus, sed pulvinar quam lorem at metus.
        Curabitur ante diam, laoreet laoreet auctor non, sollicitudin ac velit.
        Quisque pretium nunc magna, ac ornare purus pharetra eget. Orci varius
        natoque penatibus et magnis dis parturient montes, nascetur ridiculus
        mus. Nullam in arcu pellentesque, finibus tellus varius, facilisis
        dolor. Curabitur tempor felis vitae turpis tristique vehicula. Praesent
        quis magna in metus mattis imperdiet et rutrum libero. Morbi leo dui,
        rutrum eget cursus eu, rhoncus vel diam. Aenean molestie pharetra
        imperdiet. Quisque ultrices, enim sit amet viverra efficitur, tellus
        augue interdum odio, in viverra augue eros sit amet tellus.
    </p>

    <p>
        Quisque vel aliquet ex. Donec dui lacus, faucibus a nisi id, vulputate
        sagittis lorem. Aenean pretium purus in lacus scelerisque luctus.
        Pellentesque efficitur in magna in malesuada. Nunc vestibulum interdum
        nunc eget dictum. Mauris ullamcorper, diam ut pretium tincidunt, diam
        mi tempus dui, id scelerisque turpis augue id dui. Donec euismod, leo
        porta ultrices dictum, augue nibh rhoncus quam, ac volutpat odio ante
        id augue.
    </p>

    <p>
        Curabitur venenatis, leo sit amet consequat porta, odio turpis
        tincidunt ligula, condimentum auctor lacus velit ut lectus. Sed in
        massa non justo fringilla rhoncus dapibus quis est. Donec tincidunt
        magna turpis, ac condimentum purus vulputate et. Pellentesque risus
        nisi, pulvinar ut rhoncus sit amet, interdum at felis. Fusce ligula
        massa, ornare nec ultrices vel, fermentum varius metus. Fusce sed
        placerat erat. Pellentesque habitant morbi tristique senectus et netus
        et malesuada fames ac turpis egestas. Maecenas tortor eros, maximus non
        tincidunt nec, accumsan et nunc. Mauris velit nisl, venenatis vel
        fermentum ut, gravida et odio. Donec et auctor eros, vitae scelerisque
        augue. Sed euismod tellus vel urna hendrerit, vitae vulputate augue
        venenatis. Nunc rhoncus, massa a facilisis egestas, ligula felis rutrum
        lorem, a egestas nisl nisi sed enim. Fusce non dapibus elit, nec
        consequat augue.        
    </p>

    <p>
        Ut leo augue, fermentum sed nisi non, tempus mattis elit. Praesent eu
        ipsum ac arcu porttitor consequat a at tellus. Praesent non volutpat
        orci, a sollicitudin justo. Suspendisse potenti. Nullam facilisis nunc
        non magna vehicula, at pulvinar odio feugiat. Nam rhoncus nunc nec
        libero suscipit viverra. Mauris dui ante, porta quis tellus at,
        consequat convallis sapien. Vivamus eu enim ut felis facilisis porta
        vel quis leo. Suspendisse varius molestie tristique.
    </p>




    <script type="module">
        import { createMultiDistributionWidget, createComparisonsWidget, createBayesianComparisonsWidget } from './src/index.js';

        // Initialize widget when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Create initial distribution that covers the whole year range
            // from 20% at start to 100% at end (non-zero y-intercept)
            const numPeriods = (2040 - 2026) * 4 + 1; // 14 years * 4 quarters + 1 = 57 quarters
            const initialDistribution = Array(numPeriods).fill(0).map((_, i) => 0.2 + (0.8 * i / (numPeriods - 1)));

            // Create multi-distribution widget
            const widget = createMultiDistributionWidget('distribution-widget', {
                height: 500,
                startYear: 2026,
                endYear: 2040
            });

            // Create comparisons widget
            const comparisonsWidget = createComparisonsWidget('comparisons-widget', {
                height: 500,
                startYear: 2026,
                endYear: 2040,
                distributions: widget.getDistributions()
            });

            // Create Bayesian comparisons widget
            const bayesianComparisonsWidget = createBayesianComparisonsWidget('bayesian-comparisons-widget', {
                height: 400,
                startYear: 2026,
                endYear: 2040,
                distributions: widget.getDistributions()
            });

            // Multi-distribution widget controls
            const colorSelect = document.getElementById('distribution-color');
            const visibilityTogglesContainer = document.getElementById('visibility-toggles');

            // Color schemes for visibility toggles
            const colorSchemes = {
                blue: '#007bff',
                green: '#28a745',
                red: '#dc3545',
                purple: '#6f42c1',
                orange: '#fd7e14',
                yellow: '#ffc107'
            };

            // Create visibility toggles
            function createVisibilityToggles() {
                visibilityTogglesContainer.innerHTML = '';
                const distributions = widget.getDistributions();
                const activeIndex = widget.getActiveDistributionIndex();
                
                distributions.forEach((distribution, index) => {
                    const toggle = document.createElement('div');
                    toggle.className = 'visibility-toggle';
                    toggle.innerHTML = `
                        <input type="checkbox" id="toggle-${distribution.color}">
                        <div class="color-box" style="background-color: ${colorSchemes[distribution.color]}"></div>
                        <span class="label">${distribution.color.charAt(0).toUpperCase() + distribution.color.slice(1)}</span>
                    `;
                    
                    const checkbox = toggle.querySelector('input[type="checkbox"]');
                    
                    // Handle active distribution logic
                    if (index === activeIndex) {
                        // Active distribution should always be visible and
                        // disabled
                        checkbox.checked = true;
                        checkbox.disabled = true;
                        widget.setDistributionVisibility(index, true);
                    } else {
                        // Background distributions start hidden by default
                        checkbox.checked = false;
                        checkbox.disabled = false;
                        widget.setDistributionVisibility(index, false);
                    }
                    
                    // Add event listener
                    checkbox.addEventListener('change', () => {
                        widget.setDistributionVisibility(index, checkbox.checked);
                    });
                    
                    visibilityTogglesContainer.appendChild(toggle);
                });
            }



            // Update visibility toggles when active distribution changes
            function updateVisibilityToggles() {
                const distributions = widget.getDistributions();
                const activeIndex = widget.getActiveDistributionIndex();
                
                distributions.forEach((distribution, index) => {
                    const checkbox = document.getElementById(`toggle-${distribution.color}`);
                    if (checkbox) {
                        if (index === activeIndex) {
                            // Active distribution should always be visible and
                            // disabled
                            checkbox.checked = true;
                            checkbox.disabled = true;
                            widget.setDistributionVisibility(index, true);
                        } else {
                            // Background distributions can be toggled
                            checkbox.disabled = false;
                            // Don't change the checked state if it's already
                            // been manually set
                            if (!checkbox.hasAttribute('data-initialized')) {
                                checkbox.checked = widget.getDistributionVisibility(index);
                                checkbox.setAttribute('data-initialized', 'true');
                            }
                        }
                    }
                });
            }

            // Debounce function to avoid excessive updates
            let debounceTimer;

            function updateColorSelect() {
                const activeIndex = widget.getActiveDistributionIndex();
                if (activeIndex >= 0) {
                    const distributions = widget.getDistributions();
                    const activeColor = distributions[activeIndex].color;
                    colorSelect.value = activeColor;
                }
            }



            // Handle color dropdown changes
            colorSelect.addEventListener('change', () => {
                const color = colorSelect.value;
                widget.setActiveDistributionByColor(color);
                updateVisibilityToggles();
                
                // Make the selected distribution visible in the comparisons
                // widget (preserving visibility of previously selected
                // distributions)
                const distributions = widget.getDistributions();
                const selectedIndex = distributions.findIndex(dist => dist.color === color);
                if (selectedIndex !== -1) {
                    comparisonsWidget.setDistributionVisibility(selectedIndex, true);
                }
            });

            // Set up callback to update comparisons widget when distributions
            // change
            widget.setOnChange((distributions) => {
                comparisonsWidget.updateDistributions(distributions);
                bayesianComparisonsWidget.updateDistributions(distributions);
                // Update the UI controls to reflect the active distribution
                updateColorSelect();
                updateVisibilityToggles();
            });

            // Initialize
            createVisibilityToggles();
            updateColorSelect();
            updateVisibilityToggles();
            
            // Make the initial active distribution visible in the comparisons
            // widget
            const initialActiveIndex = widget.getActiveDistributionIndex();
            if (initialActiveIndex !== -1) {
                comparisonsWidget.setDistributionVisibility(initialActiveIndex, true);
            }
        });
    </script>
</body>
</html>
