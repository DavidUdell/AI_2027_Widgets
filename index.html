<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 2027 Widgets Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            max-width: 1000px;
            margin: 0 auto;
            padding: 5px;
            color: #333;
        }

        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #2a623d;
            padding-bottom: 10px;
        }

        h2 {
            color: #2c3e50;
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .widget-container {
            display: block;
            text-align: center;
            margin: 20px auto;
            padding: 5px;
            width: 100%;
            min-height: 600px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fffff8;
            box-sizing: border-box;
        }

        .widget-container h3 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 20px;
        }

        .widget-container h2 {
            margin-top: 0;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 10px;
            font-size: 24px;
            text-align: left;
        }

        .widget-container p {
            text-align: left;
        }

        .widget-canvas {
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f8f9fa;
            cursor: crosshair;
            max-width: 100%;
            display: block;
            margin: 0 auto;
            touch-action: none;
        }

        .instructions {
            background: #fffff8;
            border-left: 4px solid #2a623d;
            padding: 12px;
            margin: 20px 0;
            border-radius: 4px;
        }

        /* Visibility toggle styles */
        .visibility-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .visibility-toggle input[type="checkbox"] {
            margin: 0;
            cursor: pointer;
            accent-color: #495057;
        }

        .visibility-toggle input[type="checkbox"]:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        .visibility-toggle .color-box {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            border: 1px solid #ccc;
        }

        .visibility-toggle .label {
            font-size: 12px;
            font-weight: 500;
            color: #495057;
        }

    </style>
</head>
<body>
    <h1>AI 2027 Widgets Demo</h1>

    <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod
        tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim
        veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
        commodo consequat.
    </p>

    <p>
        Duis aute irure dolor in reprehenderit in voluptate velit esse cillum
        dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non
        proident, sunt in culpa qui officia deserunt mollit anim id est
        laborum.
    </p>

    <p>
        Sed ut perspiciatis unde omnis iste natus error sit voluptatem
        accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae
        ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt
        explicabo.
    </p>

    <p>
        Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut
        fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem
        sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor
        sit amet, consectetur, adipisci velit, sed quia non numquam eius modi
        tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem.
    </p>

    <div class="widget-container">
        <h2>AGI Timelines</h2>

        <!-- Distribution Controls -->
        <div style="margin-bottom: 20px; text-align: center;">
            <div style="display: flex; justify-content: center; align-items:
            center; gap: 15px; flex-wrap: wrap;">
                <!-- Color Selection -->
                <div style="display: flex; align-items: center; gap: 8px;">
                    <label for="distribution-color" style="font-weight:
                    bold;">Drawing:</label>
                    <select id="distribution-color" style="padding: 4px 8px;
                    border: 1px solid #ccc; border-radius: 4px; font-size:
                    14px;">
                        <option value="blue">Blue</option>
                        <option value="green">Green</option>
                        <option value="red">Red</option>
                        <option value="purple">Purple</option>
                        <option value="orange">Orange</option>
                        <option value="yellow">Yellow</option>
                    </select>
                </div>
                
                <!-- Visibility Toggles -->
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-weight: bold;">Background:</span>
                    <div id="visibility-toggles" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; width: 300px;">
                        <!-- Checkboxes will be added here dynamically -->
                    </div>
                </div>

            </div>
        </div>

        <div id="interactive-widget"></div>
        <div style="margin-top: 50px;">
            <div class="instructions">
                <strong>Note:</strong> <i>Lower</i> values indicate better
                agreement, with 0.00 being perfect agreement.
            </div>
            <div id="calculator-widget"></div>
        </div>

    </div>

    <p>
        Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis
        suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis
        autem vel eum iure reprehenderit qui in ea voluptate velit esse quam
        nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo
        voluptas nulla pariatur?
    </p>

    <p>
        Vivamus congue mauris neque, sollicitudin porttitor ipsum tempus
        eleifend. Interdum et malesuada fames ac ante ipsum primis in faucibus.
        Mauris molestie sodales commodo. Nunc ultrices mauris magna, non
        condimentum tellus varius a. Praesent hendrerit, massa ac iaculis
        scelerisque, risus est maximus risus, sed pulvinar quam lorem at metus.
        Curabitur ante diam, laoreet laoreet auctor non, sollicitudin ac velit.
        Quisque pretium nunc magna, ac ornare purus pharetra eget. Orci varius
        natoque penatibus et magnis dis parturient montes, nascetur ridiculus
        mus. Nullam in arcu pellentesque, finibus tellus varius, facilisis
        dolor. Curabitur tempor felis vitae turpis tristique vehicula. Praesent
        quis magna in metus mattis imperdiet et rutrum libero. Morbi leo dui,
        rutrum eget cursus eu, rhoncus vel diam. Aenean molestie pharetra
        imperdiet. Quisque ultrices, enim sit amet viverra efficitur, tellus
        augue interdum odio, in viverra augue eros sit amet tellus.
    </p>

    <p>
        Quisque vel aliquet ex. Donec dui lacus, faucibus a nisi id, vulputate
        sagittis lorem. Aenean pretium purus in lacus scelerisque luctus.
        Pellentesque efficitur in magna in malesuada. Nunc vestibulum interdum
        nunc eget dictum. Mauris ullamcorper, diam ut pretium tincidunt, diam
        mi tempus dui, id scelerisque turpis augue id dui. Donec euismod, leo
        porta ultrices dictum, augue nibh rhoncus quam, ac volutpat odio ante
        id augue.
    </p>

    <p>
        Curabitur venenatis, leo sit amet consequat porta, odio turpis
        tincidunt ligula, condimentum auctor lacus velit ut lectus. Sed in
        massa non justo fringilla rhoncus dapibus quis est. Donec tincidunt
        magna turpis, ac condimentum purus vulputate et. Pellentesque risus
        nisi, pulvinar ut rhoncus sit amet, interdum at felis. Fusce ligula
        massa, ornare nec ultrices vel, fermentum varius metus. Fusce sed
        placerat erat. Pellentesque habitant morbi tristique senectus et netus
        et malesuada fames ac turpis egestas. Maecenas tortor eros, maximus non
        tincidunt nec, accumsan et nunc. Mauris velit nisl, venenatis vel
        fermentum ut, gravida et odio. Donec et auctor eros, vitae scelerisque
        augue. Sed euismod tellus vel urna hendrerit, vitae vulputate augue
        venenatis. Nunc rhoncus, massa a facilisis egestas, ligula felis rutrum
        lorem, a egestas nisl nisi sed enim. Fusce non dapibus elit, nec
        consequat augue.        
    </p>

    <p>
        Ut leo augue, fermentum sed nisi non, tempus mattis elit. Praesent eu
        ipsum ac arcu porttitor consequat a at tellus. Praesent non volutpat
        orci, a sollicitudin justo. Suspendisse potenti. Nullam facilisis nunc
        non magna vehicula, at pulvinar odio feugiat. Nam rhoncus nunc nec
        libero suscipit viverra. Mauris dui ante, porta quis tellus at,
        consequat convallis sapien. Vivamus eu enim ut felis facilisis porta
        vel quis leo. Suspendisse varius molestie tristique.
    </p>

    <script>
var AI2027Widgets=function(ee){"use strict";function ye(D,a){const k=document.getElementById(D);if(!k){console.error(`Container with ID '${D}' not found`);return}function C(){return window.innerWidth<500?.75:1}const M=a.enableUrlState!==!1,f=document.createElement("canvas");let h=k.getBoundingClientRect().width;f.width=h;const u=500;f.height=u,f.className="widget-canvas";const e=f.getContext("2d"),g=2026,E=2040-g+1,y=(E-1)*4+1;let n=[],d=0;const v={};let V={},T={},w=!1,F=0,Y=0,R=!1,H=0,G=1,N=!1,U=0,X=0,c=70,q=h-2*c,B=u-2*c,_=q/(y-1);function Se(){if(!M)return;const t=`d=${n.map(s=>{const l=De(s.values);return`${s.color}:${l}`}).join(",")}`;if(window.history&&window.history.replaceState){const s=window.location.pathname+window.location.search+"#"+t;window.history.replaceState(null,"",s)}}function De(r){return r.map(s=>Math.round(Math.max(K,s)*1e3)).map(s=>s.toString(36).toUpperCase().padStart(2,"0")).join("")}function ke(r){if(!r||typeof r!="string"||r.length===0)return null;const t=2;if(r.length%t!==0)return null;const s=[];for(let l=0;l<r.length;l+=t)s.push(r.slice(l,l+t));try{const l=s.map(i=>{if(!/^[0-9A-Za-z]{2}$/.test(i))throw new Error(`Invalid chunk format: ${i}`);const o=parseInt(i.toUpperCase(),36);if(isNaN(o)||o<0||o>1e3)throw new Error(`Invalid value: ${o} from chunk ${i}`);return Math.max(K,o/1e3)});for(let i=0;i<l.length;i++)if(l[i]<0||l[i]>1)throw new Error(`Invalid probability value: ${l[i]} at index ${i}`);return l}catch(l){return console.warn("Failed to decode distribution values:",l.message),null}}function le(){if(!M)return!1;const r=window.location.hash.substring(1);if(!r)return!1;try{const s=new URLSearchParams(r).get("d");if(s){const l=s.split(","),i=[];let o=!1;for(const S of l){const[p,P]=S.split(":");if(!p||!P){console.warn("Invalid distribution format:",S),o=!0;break}if(!["blue","green","red","purple","orange","yellow"].includes(p)){console.warn("Invalid distribution color:",p),o=!0;break}const L=ke(P);if(L===null){console.warn("Failed to decode distribution values for color:",p),o=!0;break}if(L.length!==y){console.warn(`Invalid number of values for ${p}: expected ${y}, got ${L.length}`),o=!0;break}if(i.some(I=>I.color===p)){console.warn("Duplicate distribution color:",p),o=!0;break}i.push({color:p,values:L})}if(o)return console.warn("Invalid distributions detected, falling back to initialization state"),!1;const b=["blue","green","red","purple","orange","yellow"],m=i.map(S=>S.color),x=b.filter(S=>!m.includes(S));if(x.length>0&&(console.warn(`Missing colors: ${x.join(", ")}. Filling with default values.`),x.forEach(S=>{const p=Array(y).fill(0).map((P,W)=>.2+.8*W/(y-1));i.push({color:S,values:p})})),i.length>0)return n=i,n.forEach((S,p)=>{V[p]=[...S.values]}),d=0,G=1,N=!1,n.forEach((S,p)=>{v[p]=p===0}),!0}return!1}catch(t){return console.warn("Failed to parse URL state:",t),!1}}function we(){if(!M)return;le()||Ce(),n.length>0&&d>=0&&O(),window.addEventListener("hashchange",()=>{le()&&(O(),z(),a.onChange&&a.onChange(n))})}function Ce(){["blue","green","red","purple","orange","yellow"].forEach((t,s)=>{const l=Array(y).fill(0).map((i,o)=>.2+.8*o/(y-1));n.push({color:t,values:l}),V[s]=[...l]})}let te=null;function j(){te&&clearTimeout(te),te=setTimeout(()=>{Se()},500)}function ie(){const t=k.getBoundingClientRect().width;t!==h&&(h=t,f.width=h,c=70,q=h-2*c,B=u-2*c,_=q/(y-1)),z()}new ResizeObserver(()=>{ie()}).observe(k);const Ee=()=>ie();window.addEventListener("resize",Ee);const ne={blue:{primary:"#007bff",gradientStart:"rgba(0, 123, 255, 0.3)",gradientEnd:"rgba(0, 123, 255, 0.1)",stroke:"#007bff"},green:{primary:"#28a745",gradientStart:"rgba(40, 167, 69, 0.3)",gradientEnd:"rgba(40, 167, 69, 0.1)",stroke:"#28a745"},red:{primary:"#dc3545",gradientStart:"rgba(220, 53, 69, 0.3)",gradientEnd:"rgba(220, 53, 69, 0.1)",stroke:"#dc3545"},purple:{primary:"#6f42c1",gradientStart:"rgba(111, 66, 193, 0.3)",gradientEnd:"rgba(111, 66, 193, 0.1)",stroke:"#6f42c1"},orange:{primary:"#fd7e14",gradientStart:"rgba(253, 126, 20, 0.3)",gradientEnd:"rgba(253, 126, 20, 0.1)",stroke:"#fd7e14"},yellow:{primary:"#ffc107",gradientStart:"rgba(255, 193, 7, 0.3)",gradientEnd:"rgba(255, 193, 7, 0.1)",stroke:"#ffc107"}};function Ie(){n.forEach((r,t)=>{v[t]=t===d})}const K=1e-6;function ae(r,t){const s=Math.round((r-c)/_),l=Math.max(0,Math.min(y-1,s)),i=1-(t-c)/B,o=Math.max(K,Math.min(1,i));return{periodIndex:l,probability:o}}function se(r,t){const s=c+r*_,l=c+(1-t)*B;return{x:s,y:l}}function z(){e.fillStyle="#f8f9fa",e.fillRect(0,0,h,u),Te(),Pe(),Ae(),Ve()}function Z(r){const t=r.values.reduce((l,i)=>l+i,0),s=t>0?100/t:0;return Math.max(...r.values)*s}function Me(r){if(r<0||r>=n.length)return;const t=n[r],s=Math.max(...t.values);if(s<=0)return;const i=B/B;if(s>i){const o=i/s;G=o,n.forEach((b,m)=>{for(let x=0;x<b.values.length;x++)b.values[x]*=o}),H=c+(1-i)*B,N=!1}else G=1,N=!1}function O(){if(d>=0&&d<n.length){const r=n[d],t=Math.max(...r.values);if(!N)H=c+(1-t)*B;else{const s=1-(H-c)/B;Math.abs(s-t)>.01&&(H=c+(1-t)*B)}}}function Te(){const r=n.map((o,b)=>({dist:o,index:b})).filter(({index:o})=>v[o]&&o!==d);if(r.length===0){U=0,X=0;return}let t=0;if(d>=0&&d<n.length){const o=n[d];t=Z(o)}const l=r.map(({dist:o})=>{const b=Math.max(...o.values),m=Z(o);return{maxValue:b,normalizedPeak:m}}).filter(o=>o.normalizedPeak<t);if(l.length===0){U=0,X=0;return}l.sort((o,b)=>b.normalizedPeak-o.normalizedPeak);const i=l[0];i?(U=c+(1-i.maxValue)*B,X=i.normalizedPeak):(U=0,X=0)}function ce(r,t){const s="9.99%";e.font="12px -apple-system, BlinkMacSystemFont, sans-serif";const i=e.measureText(s).width+8,o=16,b=c-5-i;return r>=b&&r<=c-5&&t>=H-o/2&&t<=H+o/2}function Pe(){if(e.strokeStyle="#dee2e6",e.lineWidth=1,e.beginPath(),e.rect(c,c,q,B),e.stroke(),d>=0&&d<n.length){const t=n[d];if(t.values.reduce((l,i)=>l+i,0)>0&&Z(t)>0){const i=H,o=ne[t.color];R?(e.strokeStyle=o.stroke,e.lineWidth=2):(e.strokeStyle="#adb5bd",e.lineWidth=1),e.setLineDash([3,3]),e.beginPath(),e.moveTo(c,i),e.lineTo(h-c,i),e.stroke(),e.setLineDash([]);const b=I=>I<10?I.toFixed(2)+"%":Math.round(I)+"%",m=Z(t);e.fillStyle=R?o.stroke:"#495057",e.font="12px -apple-system, BlinkMacSystemFont, sans-serif",e.textAlign="center",e.textBaseline="middle";const x=b(m),p=e.measureText(x).width+8,P=16,W=c-5-p,L=i-P/2;if(R){const I=o.stroke.replace("#",""),oe=parseInt(I.substr(0,2),16),Q=parseInt(I.substr(2,2),16),re=parseInt(I.substr(4,2),16);e.fillStyle=`rgba(${oe}, ${Q}, ${re}, 0.1)`}else e.fillStyle="rgba(73, 80, 87, 0.1)";e.fillRect(W,L,p,P),e.strokeStyle=R?o.stroke:"#495057",e.lineWidth=1,e.strokeRect(W,L,p,P),e.fillStyle=R?o.stroke:"#495057",e.fillText(x,W+p/2,i)}}if(n.forEach((t,s)=>{if(!v[s])return;const l=t.values.reduce((i,o)=>i+o,0);if(l>0){const i=l/2;let o=0,b=0;for(let J=0;J<t.values.length;J++)if(o+=t.values[J],o>=i){b=J;break}const m=se(b,0).x,x=ne[t.color],S=x.stroke.replace("#",""),p=parseInt(S.substr(0,2),16),P=parseInt(S.substr(2,2),16),W=parseInt(S.substr(4,2),16);e.strokeStyle=`rgba(${p}, ${P}, ${W}, 0.7)`,e.lineWidth=1,e.setLineDash([5,5]),e.beginPath(),e.moveTo(m,c),e.lineTo(m,u-c),e.stroke(),e.setLineDash([]);const L=g+Math.floor(b/4),I=b%4+1,oe=L.toString().slice(-2);e.fillStyle=x.stroke,e.font=`${Math.round(12*C())}px -apple-system, BlinkMacSystemFont, sans-serif`,e.textAlign="center",e.textBaseline="bottom";const Q=c-10,re=Q-14,ge="’",be=oe,$e=e.measureText(ge).width,he=e.measureText(be).width,pe=$e+he;e.textAlign="left",e.fillText(ge,m-pe/2,Q),e.fillText(be,m+pe/2-he,Q),e.textAlign="center",e.fillText(`Q${I}`,m,re)}}),e.fillStyle="#495057",e.font="12px -apple-system, BlinkMacSystemFont, sans-serif",e.textAlign="center",e.textBaseline="bottom",e.fillText("Medians",h/2,c-35),d>=0&&d<n.length&&n[d].values.reduce((t,s)=>t+s,0)>0){const t=n[d],s=Math.max(...t.values),l=Math.abs(s-K)<1e-10,i=G<.1;!l&&!i&&(e.fillStyle="#495057",e.font="12px -apple-system, BlinkMacSystemFont, sans-serif",e.textAlign="right",e.textBaseline="middle",e.fillText("ε%",c-10,u-c))}else e.fillStyle="#495057",e.font="12px -apple-system, BlinkMacSystemFont, sans-serif",e.textAlign="right",e.textBaseline="middle",e.fillText("ε%",c-10,u-c);if(U>0&&X>0){e.strokeStyle="#adb5bd",e.lineWidth=1,e.setLineDash([3,3]),e.beginPath(),e.moveTo(c,U),e.lineTo(h-c,U),e.stroke(),e.setLineDash([]);const t=i=>i<10?i.toFixed(2)+"%":Math.round(i)+"%";e.fillStyle="#6c757d",e.font="12px -apple-system, BlinkMacSystemFont, sans-serif",e.textAlign="left",e.textBaseline="middle";const s=t(X),l=h-c+5;e.fillText(s,l,U)}}function Ae(){e.fillStyle="#495057",e.font=`${Math.round(12*C())}px -apple-system, BlinkMacSystemFont, sans-serif`,e.textAlign="center",e.textBaseline="middle";const r=C()<1;for(let t=0;t<E;t++){if(r&&t>0&&t<E-1&&t%2===1)continue;let s;t===E-1?s=c+(y-1)*_:s=c+t*4*_;const l=g+t;if(t===E-1){const i=[">2039","or AGI never"],b=u-c/2-18;i.forEach((m,x)=>{e.fillText(m,s,b+x*14)})}else if(t===0)e.fillText(l.toString(),s,u-c/2-18);else{const i=l.toString().slice(-2);e.fillText(`’${i}`,s,u-c/2-18)}}e.fillStyle="#495057",e.font="bold 16px -apple-system, BlinkMacSystemFont, sans-serif",e.textAlign="center",e.textBaseline="top",e.fillText("Quarters",h/2,u-c/2+7),e.save(),e.translate(c/2-22,u/2),e.rotate(-Math.PI/2),e.fillStyle="#495057",e.font="bold 16px -apple-system, BlinkMacSystemFont, sans-serif",e.textAlign="center",e.textBaseline="middle",e.fillText("AGI Invented In",0,0),e.restore()}function Ve(){if(n.forEach((r,t)=>{t!==d&&v[t]&&ue(r,!1)}),d>=0&&d<n.length&&v[d]){const r=n[d];ue(r,!0)}}function ue(r,t){const s=ne[r.color];if(!s)return;e.save(),e.beginPath(),e.rect(c,c,q,B),e.clip();const l=e.createLinearGradient(c,c,c,u-c);if(t)l.addColorStop(0,s.gradientStart),l.addColorStop(1,s.gradientEnd);else{const i=s.gradientStart.replace("0.3)","0.15)"),o=s.gradientEnd.replace("0.1)","0.05)");l.addColorStop(0,i),l.addColorStop(1,o)}e.fillStyle=l,e.beginPath(),e.moveTo(c,u-c);for(let i=0;i<y;i++){const o=se(i,r.values[i]);e.lineTo(o.x,o.y)}if(e.lineTo(h-c,u-c),e.closePath(),e.fill(),t)e.strokeStyle=s.stroke,e.lineWidth=2;else{const i=s.stroke.replace("#",""),o=parseInt(i.substr(0,2),16),b=parseInt(i.substr(2,2),16),m=parseInt(i.substr(4,2),16);e.strokeStyle=`rgba(${o}, ${b}, ${m}, 0.5)`,e.lineWidth=1.5}e.beginPath();for(let i=0;i<y;i++){const o=se(i,r.values[i]);i===0?e.moveTo(o.x,o.y):e.lineTo(o.x,o.y)}e.stroke(),e.restore()}function Be(r){const t=f.getBoundingClientRect(),s=r.clientX-t.left,l=r.clientY-t.top;if(ce(s,l)){R=!0,N=!0,f.style.cursor="ns-resize",z();return}w=!0,F=s,Y=l,N=!1;const{periodIndex:i,probability:o}=ae(s,l);n[d].values[i]=o,T[d]=!0,O(),z(),a.onChange&&a.onChange(n),j()}function Le(r){const t=f.getBoundingClientRect(),s=r.clientX-t.left,l=r.clientY-t.top;if(!R&&!w&&(ce(s,l)?f.style.cursor="ns-resize":f.style.cursor="crosshair"),R){const m=Math.max(c,Math.min(u-c,l));if(H=m,d>=0&&d<n.length){const x=n[d],S=Math.max(...x.values),p=1-(m-c)/B;G=Math.max(K,p/S),n.forEach((P,W)=>{const L=[...P.values];for(let I=0;I<P.values.length;I++)P.values[I]=L[I]*G})}z(),a.onChange&&a.onChange(n),j();return}if(!w)return;const i=s-F,o=l-Y,b=Math.sqrt(i*i+o*o);if(b>2){const m=Math.ceil(b/2);for(let x=0;x<=m;x++){const S=x/m,p=F+i*S,P=Y+o*S,{periodIndex:W,probability:L}=ae(p,P);n[d].values[W]=L,T[d]=!0}F=s,Y=l,O(),z(),a.onChange&&a.onChange(n),j()}}function de(){R&&(R=!1,f.style.cursor="crosshair",z()),w&&(fe(),d>=0&&d<n.length&&(V[d]=[...n[d].values]),O(),j()),w=!1}function fe(){const t=n[d].values.reduce((s,l)=>s+l,0);t<=0||(n.forEach((s,l)=>{if(l!==d){const i=s.values.reduce((o,b)=>o+b,0);if(i>0){const o=t/i;for(let b=0;b<s.values.length;b++)s.values[b]*=o}}}),z(),a.onChange&&a.onChange(n),j())}return f.addEventListener("pointerdown",Be),f.addEventListener("pointermove",Le),f.addEventListener("pointerup",de),f.addEventListener("pointerleave",de),f.addEventListener("contextmenu",r=>r.preventDefault()),f.addEventListener("touchstart",r=>r.preventDefault(),{passive:!1}),f.addEventListener("touchmove",r=>r.preventDefault(),{passive:!1}),k.appendChild(f),we(),Ie(),O(),z(),{setActiveDistributionByColor:r=>{const t=n.findIndex(s=>s.color===r);t<0||(d=t,G=1,N=!1,n.forEach((s,l)=>{V[l]&&!T[l]&&(s.values=[...V[l]])}),ie(),Me(t),O(),v[t]=!0,fe(),j())},getDistributions:()=>[...n],getActiveDistributionIndex:()=>d,setOnChange:r=>{a.onChange=r},setDistributionVisibility:(r,t)=>{v.hasOwnProperty(r)&&(v[r]=t,z())},getDistributionVisibility:r=>v[r]||!1,getVisibilityState:()=>({...v})}}function me(D,a){if(D.length!==a.length)throw new Error("Distributions must have the same shape");if(D.length===0)throw new Error("Distributions must have at least one entry");if(D.some(u=>!Number.isFinite(u))||a.some(u=>!Number.isFinite(u)))throw new Error("Distributions must be finite");if(D.some(u=>u<-1e-12)||a.some(u=>u<-1e-12))throw new Error("Distributions cannot contain negative values");let C,M;const f=D.reduce((u,e)=>u+e,0),A=a.reduce((u,e)=>u+e,0);f<1e-12?M=D.map(u=>1/D.length):M=D.map(u=>u/f),A<1e-12?C=a.map(u=>1/a.length):C=a.map(u=>u/A);let h=0;for(let u=0;u<C.length;u++){const e=C[u],g=M[u];if(!(e<=0)){if(!(g>0))return 1/0;h+=e*Math.log(e/g)}}return h}function ve(D,a){const k=document.getElementById(D);if(!k){console.error(`Container with ID '${D}' not found`);return}const C=document.createElement("div");C.style.width="100%",C.style.fontFamily="-apple-system, BlinkMacSystemFont, sans-serif";const M=document.createElement("div");M.style.marginBottom="20px",M.style.textAlign="center";const f=document.createElement("div");f.style.display="flex",f.style.flexDirection="column",f.style.alignItems="center",f.style.gap="15px",f.style.marginBottom="15px",f.style.padding="20px",f.style.border="3px solid #2c3e50",f.style.borderRadius="8px",f.style.backgroundColor="#f8f9fa",f.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)";const A=document.createElement("div");A.textContent="Kullback–Leibler Divergence",A.style.fontWeight="bold",A.style.fontSize="16px",A.style.color="#2c3e50",A.style.marginBottom="15px",A.style.textAlign="center";const h=document.createElement("div");h.style.display="flex",h.style.justifyContent="center",h.style.alignItems="center",h.style.gap="12px",h.style.marginBottom="15px";const u=document.createElement("label");u.textContent="Ground Truth:",u.style.fontWeight="bold",u.style.color="#2c3e50",u.style.fontSize="14px";const e=document.createElement("span");e.style.fontSize="14px",e.style.fontWeight="bold",e.style.color="#2c3e50",h.appendChild(u),h.appendChild(e),f.appendChild(A),f.appendChild(h);const g=document.createElement("div");g.style.marginTop="0px",g.style.padding="0px",g.style.backgroundColor="transparent",g.style.borderRadius="0px",g.style.border="none",g.style.minHeight="0px",g.style.display="none",g.style.width="100%",M.appendChild(f),f.appendChild(g),C.appendChild(M);function $(){if(!a.distributions||a.distributions.length===0){e.textContent="None";return}const n=a.activeDistributionIndex||0;if(n>=0&&n<a.distributions.length){const d=a.distributions[n];e.textContent=d.color.charAt(0).toUpperCase()+d.color.slice(1)}else e.textContent="None"}function E(n){return Number.isFinite(n)?n.toFixed(2):"∞"}function y(){const n=a.activeDistributionIndex||0;if(g.innerHTML="",n<0||!a.distributions||a.distributions.length===0||n>=a.distributions.length){g.style.display="none";return}const d=a.distributions[n],v=a.distributions.map((T,w)=>{const F=me(T.values,d.values);return{index:w,distribution:T,klDivergence:F}}).filter(T=>T.index===n?!1:a.visibilityState&&a.visibilityState[T.index]===!0);v.sort((T,w)=>T.klDivergence-w.klDivergence),g.style.display="block",g.style.padding="0px";const V=document.createElement("div");V.style.fontSize="14px",V.style.lineHeight="1.6",v.forEach(T=>{const w=document.createElement("div");w.style.display="flex",w.style.justifyContent="center",w.style.alignItems="center",w.style.padding="4px 0",w.style.fontFamily="monospace",w.style.fontSize="13px",w.style.gap="40px";const F=document.createElement("span");F.textContent=T.distribution.color.charAt(0).toUpperCase()+T.distribution.color.slice(1),F.style.minWidth="80px",F.style.textAlign="center";const Y=document.createElement("span");Y.textContent=E(T.klDivergence),Y.style.minWidth="60px",Y.style.textAlign="center",w.appendChild(F),w.appendChild(Y),V.appendChild(w)}),g.appendChild(V)}return k.appendChild(C),$(),g.style.display="none",{updateDistributions:n=>{a.distributions=n,$(),y()},setActiveDistributionIndex:n=>{a.activeDistributionIndex=n,$(),y()},setVisibilityState:n=>{a.visibilityState=n,y()}}}function xe(D=document){const a=ye("interactive-widget",{}),k=ve("calculator-widget",{distributions:a.getDistributions(),activeDistributionIndex:a.getActiveDistributionIndex(),visibilityState:a.getVisibilityState()}),C=D.getElementById("distribution-color"),M=D.getElementById("visibility-toggles"),f={blue:"#007bff",green:"#28a745",red:"#dc3545",purple:"#6f42c1",orange:"#fd7e14",yellow:"#ffc107"};function A(){M.innerHTML="";const g=a.getDistributions(),$=a.getActiveDistributionIndex(),E=a.getVisibilityState();g.forEach((y,n)=>{const d=D.createElement("div");d.className="visibility-toggle",d.innerHTML=`
                <input type="checkbox" id="toggle-${y.color}">
                <div class="color-box" style="background-color: ${f[y.color]}"></div>
                <span class="label">${y.color.charAt(0).toUpperCase()+y.color.slice(1)}</span>
            `;const v=d.querySelector('input[type="checkbox"]');if(n===$)v.checked=!0,v.disabled=!0,a.setDistributionVisibility(n,!0);else{const V=E[n]||!1;v.checked=V,v.disabled=!1,a.setDistributionVisibility(n,V)}v.addEventListener("change",()=>{a.setDistributionVisibility(n,v.checked),k&&k.setVisibilityState(a.getVisibilityState())}),M.appendChild(d)})}function h(){a.getDistributions().forEach($=>{const E=D.getElementById(`toggle-${$.color}`);E&&E.removeAttribute("data-initialized")})}function u(){const g=a.getDistributions(),$=a.getActiveDistributionIndex();g.forEach((E,y)=>{const n=D.getElementById(`toggle-${E.color}`);n&&(y===$?(n.checked=!0,n.disabled=!0,a.setDistributionVisibility(y,!0)):(n.disabled=!1,n.checked=a.getDistributionVisibility(y),n.setAttribute("data-initialized","true")))})}function e(){const g=a.getActiveDistributionIndex();if(g>=0){const E=a.getDistributions()[g].color;C.value=E}}C.addEventListener("change",()=>{const g=C.value;a.setActiveDistributionByColor(g),u(),k&&k.setActiveDistributionIndex(a.getActiveDistributionIndex())}),a.setOnChange(g=>{k&&(k.updateDistributions(g),k.setActiveDistributionIndex(a.getActiveDistributionIndex()),k.setVisibilityState(a.getVisibilityState())),h(),e(),u()}),A(),e(),u(),k&&k.setVisibilityState(a.getVisibilityState())}return ee.boot=xe,Object.defineProperty(ee,Symbol.toStringTag,{value:"Module"}),ee}({});
    </script>

    <script>
        const boot = window.AI2027Widgets.boot;
        addEventListener('DOMContentLoaded', () => {boot()});
    </script>
</body>
</html>
